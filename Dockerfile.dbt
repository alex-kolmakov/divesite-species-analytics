FROM python:3.11-slim

COPY --from=ghcr.io/astral-sh/uv:latest /uv /usr/local/bin/uv

WORKDIR /app

RUN uv pip install --system --no-cache dbt-bigquery

COPY dbt/ dbt/
COPY dbt/profiles/profiles.yml profiles/profiles.yml

RUN useradd --create-home appuser
USER appuser

ENTRYPOINT ["dbt", "run", "--profiles-dir", "/app/profiles", "--project-dir", "/app/dbt", "--log-path", "/tmp/dbt-logs", "--target-path", "/tmp/dbt-target"]
