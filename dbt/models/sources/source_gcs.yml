version: 2

sources:
  - name: marine_data
    description: >
      External GCS parquet files and BigQuery tables that back the marine species analytics
      platform. Ingested by the marine-data-ingestion Cloud Run job.
    database: gbif-412615
    loader: gcloud storage

    tables:
      - name: obis_table
        description: >
          Ocean Biogeographic Information System occurrence records. Refreshed from
          s3://obis-open-data via the ingestion pipeline. Contains species, coordinates,
          dates, and individual counts in the interpreted struct.
        external:
          location: 'gs://marine_data_412615/obis.parquet'
          options:
            format: parquet
        columns:
          - name: species
            description: Scientific name of the observed species.
          - name: decimalLatitude
            description: Latitude of the observation in decimal degrees.
          - name: decimalLongitude
            description: Longitude of the observation in decimal degrees.
          - name: eventDate
            description: Date/time of the observation as a string (cast downstream).
          - name: individualCount
            description: Number of individuals observed (may be null).

      - name: worms_table
        description: >
          World Register of Marine Species taxonomy extract. Used as the authoritative
          species validation reference. Joined on scientificName to filter occurrences.
        external:
          location: 'gs://marine_data_412615/worms.parquet'
          options:
            format: parquet
        columns:
          - name: scientificName
            description: Accepted scientific name from WoRMS taxonomy.

      - name: redlist_table
        description: >
          IUCN Red List of Threatened Species extract. Used to flag species as endangered
          in the species reference table.
        external:
          location: 'gs://marine_data_412615/redlist.parquet'
          options:
            format: parquet
        columns:
          - name: scientificName
            description: Scientific name of the species on the IUCN Red List.

      - name: invasive_table
        description: >
          Global Invasive Species Database (GISD) extract. Used to flag species as invasive
          in the species reference table.
        external:
          location: 'gs://marine_data_412615/invasive.parquet'
          options:
            format: parquet
        columns:
          - name: scientificName
            description: Scientific name of the invasive species.

      - name: divesites_table
        description: >
          PADI dive site locations scraped from the dive-guide API. Contains site name and
          coordinates for ~3,400 sites worldwide.
        external:
          location: 'gs://marine_data_412615/divesites.parquet'
          options:
            format: parquet
        columns:
          - name: title
            description: Human-readable name of the dive site.
          - name: latitude
            description: Latitude of the dive site in decimal degrees.
          - name: longitude
            description: Longitude of the dive site in decimal degrees.

      - name: species_enrichment
        description: >
          Species enrichment data populated by the enrichment pipeline (not managed by dbt).
          Contains common names (GBIF API), descriptions (Wikipedia), and images
          (Wikipedia/Wikidata). Survives dbt rebuilds since it lives outside the dbt DAG.
        columns:
          - name: species
            description: Scientific name (foreign key to species table).
          - name: common_name
            description: English common name from GBIF vernacular names API.
          - name: description
            description: Species description from Wikipedia REST API (first paragraph).
          - name: image_url
            description: Direct image URL from Wikipedia or Wikimedia Commons.
